var Shortcode=function(e,t){e&&(this.el=e,this.tags=t,this.matches=[],this.regex="\\[{name}(.*?)?\\](?:([\\s\\S]*?)(\\[/{name}\\]))?",this.el.jquery&&(this.el=this.el[0]),this.matchTags(),this.convertMatchesToNodes(),this.replaceNodes())};if(Shortcode.prototype.matchTags=function(){var e,t,r,n,a,o,s,i=this.el.outerHTML;for(var c in this.tags){if(!this.tags.hasOwnProperty(c))return;r=this.template(this.regex,{name:c});for(var h=0,p=(e=i.match(new RegExp(r,"g"))||[]).length;h<p;h++)n=(t=e[h].match(new RegExp(r)))[3]?"":void 0,o=t[0],a=this.escapeTagRegExp(o),s=this.parseOptions(t[1]),t[2]&&(n=t[2].trim(),o=o.replace(n,""),a=a.replace(n,"([\\s\\S]*?)")),this.matches.push({name:c,tag:o,regex:a,options:s,contents:n})}},Shortcode.prototype.convertMatchesToNodes=function(){var e,t,r,n=this.el.innerHTML;r=function(e,t,r,n,a,o,s){if(t)return e;var i=document.createElement("span");return i.setAttribute("data-sc-tag",this.tag),i.className="sc-node sc-node-"+this.name,i.outerHTML};for(var a=0,o=this.matches.length;a<o;a++)e='((data-sc-tag=")|(<pre.*)|(<code.*))?',t=new RegExp(e+this.matches[a].regex,"g"),n=n.replace(t,r.bind(this.matches[a]));this.el.innerHTML=n},Shortcode.prototype.replaceNodes=function(){var e,t,r,n,a,o=this;document.querySelectorAll(".sc-node");a=function(e){e.jquery&&(e=e[0]),e=o.parseCallbackResult(e),n.parentNode.replaceChild(e,n)};for(var s=0,i=this.matches.length;s<i;s++)e=this.matches[s],(n=document.querySelector(".sc-node-"+e.name))&&n.dataset.scTag===e.tag&&void 0!==(t=this.tags[e.name].bind(e)(r=a.bind(e)))&&r(t)},Shortcode.prototype.parseCallbackResult=function(e){var t,r,n;switch(typeof e){case"function":e=document.createTextNode(e());break;case"string":if(t=document.createElement("div"),r=document.createDocumentFragment(),t.innerHTML=e,(n=t.children).length){for(var a=0,o=n.length;a<o;a++)r.appendChild(n[a].cloneNode(!0));e=r}else e=document.createTextNode(e);break;case"object":e.nodeType||(e=JSON.stringify(e),e=document.createTextNode(e))}return e},Shortcode.prototype.parseOptions=function(e){var t,r={};if(e){(t=e.replace(/(\w+=)/g,"\n$1").split("\n")).shift();for(var n=0;n<t.length;n++){var a=t[n].split("=");r[a[0]]=a[1].replace(/\'|\"/g,"").trim()}return r}},Shortcode.prototype.escapeTagRegExp=function(e){return e.replace(/[\[\]\/]/g,"\\$&")},Shortcode.prototype.template=function(e,t){for(var r in t)e=e.replace(new RegExp("{"+r+"}","g"),t[r]);return e},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},window.jQuery){var pluginName="shortcode";$.fn[pluginName]=function(e){return this.each(function(){$.data(this,pluginName)||$.data(this,pluginName,new Shortcode(this,e))}),this}}
